@model TimeTracker.Models.User
@{
    ViewData["Title"] = "Home Page";
}
<style>

    .age-label {
        color: #B0B5B9;
        font-size: 1.2rem;
        line-height: 1;
        margin: 0 0 0 2px;
    }

    #cite {
        color: #B0B5B9;
        font-size: 1.2rem;
        line-height: 1;
        margin: 0 0 0 2px;
        position: fixed;
        bottom: 0;
    }

        #cite a {
            color: rgb(154, 157, 160);
            text-decoration: none;
        }

            #cite a:visited {
                color: rgb(125, 128, 131);
            }

            #cite a:hover {
                color: rgb(202, 207, 209);
            }

            #cite a:active {
                color: rgb(125, 128, 131);
            }

    .count {
        color: #494949;
        margin: 0;
        font-size: 6rem;
        line-height: 1;
        font-weight: 600;
    }

        .count sup {
            font-size: 2.4rem;
            margin-left: 7px;
        }

    #timer {
        position: absolute;
        /* top: 25%; */
        /* left: 25%; */
        transform: translate(200%, 200%);
        margin: 0;
        padding: 0;
    }
</style>
<div class="row">
    <div class="col-12">
        @if (Model.BirthDate != null)
        {
            <div id="timer" style="margin: 0; padding: 0;">
                <h1 class="age-label">AGE</h1>
                <h2 class="count" id="age"></h2>
            </div>
        } else
        {
            <form method="post" action="/home/timer/motivate">
                <div class="mb-3">
                    <label class="form-label">Publication Date</label>
                    <input type="text" id="publicationDateInput" class="form-control date" asp-for="BirthDate">
                </div>

                <input type="submit" value="Create" class="btn btn-primary" />
        </form>
        }
    </div>
    
</div>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $("#submit").click(function (e) {
                e.preventDefault();

                var input = $("#dob-input").val();
                var dob = new Date(input);
                save(dob);
                renderAgeLoop();
            });

            function save(dob) {
                localStorage.dob = dob.getTime();
            };

            function load() {
                var dob;
                if (dob = localStorage.getItem("dob")) {
                    return new Date(parseInt(dob));
                }
                return -1;
            };

            function renderAgeLoop() {
                var dob = load();
                $("#choose").css("display", "none");
                $("#timer").css("display", "block");

                setInterval(function () {
                    var age = getAge(dob);
                    $("#age").html(age.year + "<sup>." + age.ms + "</sup>");
                }, 100);
            };

            function renderChoose() {
                $("#choose").css("display", "block");
            };

            function getAge(dob) {
                var now = new Date;
                var duration = now - dob;
                var years = duration / 31556900000;

                var majorMinor = years.toFixed(9).toString().split('.');

                return {
                    "year": majorMinor[0],
                    "ms": majorMinor[1]
                };
            };

            function main() {
                if (load() != -1) {
                    renderAgeLoop();
                } else {
                    renderChoose();
                }
            };
            main();
        });
    </script>
}